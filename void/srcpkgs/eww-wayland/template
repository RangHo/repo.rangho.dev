pkgname=eww-wayland
version=0.5.0
revision=1
build_style=cargo
hostmakedepends="
    curl
    pkg-config
    glibc-devel
    libgcc-devel
"
makedepends="
    gtk+3-devel
    gtk-layer-shell-devel
    pango-devel
    gdk-pixbuf-devel
    cairo-devel
    glib-devel
"
depends="
    gtk+3
    gtk-layer-shell
"
short_desc="ElKowar's Wacky Widgets"
maintainer="RangHo Lee <hello@rangho.me>"
license="MIT"
homepage="https://github.com/elkowar/eww"
distfiles="${homepage}/archive/refs/tags/v${version}.zip"
checksum=f436395a11ef2b2ef3f0ae8618e5d5c5e417eb72ac1b3fcc8945daeda7e4b6d1

do_build() {
    # Rust Nightly is required
    curl https://sh.rustup.rs -sSf \
        | sh -s -- --no-modify-path --profile minimal --default-toolchain nightly -y
    . /host/cargo/env

    # Compile with Cargo nightly
    cargo +nightly build --release --no-default-features --features=wayland
}

do_check() {
    . /host/cargo/env

    cargo +nightly test --release --no-default-features --features=wayland
}

do_install() {
    . /host/cargo/env

    cargo +nightly install --path ./crates/eww --root="${DESTDIR}/usr" --no-default-features --features=wayland

    rm -f "${DESTDIR}"/usr/.crates.toml
    rm -f "${DESTDIR}"/usr/.crates2.json
}
